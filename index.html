<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interwiki Checker</title>
    <style>
        /* --- Color Variables --- */
        :root {
            --bg-color: #f8fafc;
            --container-bg: #ffffff;
            --text-color: #334155;
            --label-color: #0f172a;
            --heading-color: #2563eb;
            --border-color: #e2e8f0;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --output-bg: #eff6ff;
            --link-color: #2563eb;
            --status-color: #64748b;
            --footer-color: #94a3b8;
        }
        body.dark-mode {
            --bg-color: #0f172a;
            --container-bg: #1e293b;
            --text-color: #e2e8f0;
            --label-color: #f8fafc;
            --heading-color: #60a5fa;
            --border-color: #334155;
            --input-bg: #334155;
            --input-border: #475569;
            --output-bg: #1e293b;
            --link-color: #60a5fa;
            --status-color: #94a3b8;
            --footer-color: #64748b;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 95vh;
            font-size: 16px; 
        }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        h1 { color: var(--heading-color); margin: 0; font-size: 32px; font-weight: 700; }
        .theme-toggle {
            background: var(--container-bg); border: 1px solid var(--border-color); color: var(--text-color);
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 500; transition: all 0.2s;
        }
        .theme-toggle:hover { background-color: var(--input-bg); border-color: var(--link-color); }
        .container {
            background: var(--container-bg); padding: 35px; border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-color); flex: 1;
        }
        .mode-selector { display: flex; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .radio-label { display: flex; align-items: center; cursor: pointer; font-weight: 600; color: var(--text-color); font-size: 16px; }
        .radio-label input { margin-right: 8px; width: 18px; height: 18px; accent-color: var(--heading-color); }
        label.section-label { font-weight: 600; display: block; margin-top: 25px; margin-bottom: 10px; color: var(--label-color); font-size: 16px; }
        textarea {
            width: 100%; padding: 14px; border: 1px solid var(--input-border); border-radius: 8px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            box-sizing: border-box; resize: vertical; background-color: var(--input-bg);
            color: var(--text-color); font-size: 16px; line-height: 1.5; transition: border-color 0.2s;
        }
        textarea:focus { outline: none; border-color: var(--heading-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        #inputList { height: 140px; }
        .output-wrapper { position: relative; margin-top: 5px; }
        #outputRaw { height: 160px; background-color: var(--output-bg); border-color: var(--input-border); padding-right: 70px; }
        .copy-btn-overlay {
            position: absolute; top: 10px; right: 10px; background-color: var(--container-bg);
            color: var(--link-color); border: 1px solid var(--link-color); padding: 6px 12px;
            border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold; opacity: 0.9; transition: all 0.2s;
        }
        .copy-btn-overlay:hover { background-color: var(--link-color); color: #fff; opacity: 1; }
        .primary-btn { 
            background-color: #2563eb; color: white; border: none; padding: 14px 28px; border-radius: 8px;
            cursor: pointer; font-size: 17px; font-weight: 600; margin-top: 20px; width: 100%; transition: background-color 0.2s;
        }
        .primary-btn:hover { background-color: #1d4ed8; }
        .primary-btn:disabled { background-color: var(--border-color); color: var(--status-color); cursor: not-allowed; }
        table { width: 100%; border-collapse: collapse; margin-top: 35px; border-color: var(--border-color); }
        th, td { text-align: left; padding: 14px; border-bottom: 1px solid var(--border-color); }
        th { background-color: var(--bg-color); font-weight: 600; color: var(--label-color); font-size: 16px; }
        td { font-size: 16px; }
        a { color: var(--link-color); text-decoration: none; }
        a:hover { text-decoration: underline; }
        .status { margin-top: 15px; color: var(--status-color); font-size: 15px; text-align: center; }
        .missing { color: #ef4444; font-style: italic; }
        .not-exist { color: #f59e0b; font-style: italic; }
        footer { margin-top: 50px; padding: 20px; text-align: center; font-size: 15px; color: var(--footer-color); border-top: 1px solid var(--border-color); }
        footer a { color: var(--link-color); text-decoration: none; font-weight: 500; }
        footer .heart { color: #ef4444; }
        footer .github-icon { display: inline-block; vertical-align: middle; width: 18px; height: 18px; fill: var(--footer-color); margin-right: 5px; }
        footer a:hover .github-icon { fill: var(--link-color); }
    </style>
</head>
<body>

<div class="header-row">
    <h1>Interwiki Checker</h1>
    <button class="theme-toggle" onclick="toggleTheme()">üåô Mode</button>
</div>

<div class="container">
    <div class="mode-selector">
        <label class="radio-label">
            <input type="radio" name="langDirection" value="en2pa" checked onchange="updateUI()">
            English ‚Üí Punjabi
        </label>
        <label class="radio-label">
            <input type="radio" name="langDirection" value="pa2en" onchange="updateUI()">
            Punjabi ‚Üí English
        </label>
    </div>

    <label id="inputLabel" for="inputList" class="section-label">Input (English Titles):</label>
    <textarea id="inputList" placeholder="Example:&#10;History of Punjab&#10;Category:Sikhism"></textarea>
    
    <button id="btnCheck" class="primary-btn" onclick="processList()">Check Availability</button>
    <div id="status" class="status"></div>

    <label id="outputLabel" for="outputRaw" class="section-label">Found on Punjabi Wiki (Copy List):</label>
    <div class="output-wrapper">
        <textarea id="outputRaw" readonly placeholder="Results will appear here for easy copying..."></textarea>
        <button class="copy-btn-overlay" onclick="copyOutput()" title="Copy to Clipboard">Copy</button>
    </div>

    <table id="resultsTable" style="display:none;">
        <thead>
            <tr>
                <th id="thSource">Source Title</th>
                <th id="thTarget">Target Link</th>
            </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
    </table>
</div>

<footer>
    Made with <span class="heart">‚ù§</span> by <a href="https://meta.wikimedia.org/wiki/User:Kuldeepburjbhalaike" target="_blank">Kuldeep</a>
    &nbsp;|&nbsp; 
    <a href="https://github.com/Kuldeepburjbhalaike/Interwiki-Checker" target="_blank">
        <svg class="github-icon" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
        Source Code
    </a>
</footer>

<script>
    function capitalizeFirst(string) {
        if (!string) return '';
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    
    function prepareTitle(string, direction) {
        if (!string) return '';
        let normalized = string.normalize('NFC');
        if (direction === 'en2pa') {
            return normalized.charAt(0).toUpperCase() + normalized.slice(1);
        }
        return normalized;
    }

    function updateUI() {
        const direction = document.querySelector('input[name="langDirection"]:checked').value;
        const inputLabel = document.getElementById('inputLabel');
        const outputLabel = document.getElementById('outputLabel');
        const textarea = document.getElementById('inputList');
        const thSource = document.getElementById('thSource');
        const thTarget = document.getElementById('thTarget');

        if (direction === 'en2pa') {
            inputLabel.textContent = "Input (English Titles):";
            outputLabel.textContent = "Found on Punjabi Wiki (Copy List):";
            textarea.placeholder = "Example:\nHistory of Punjab\nCategory:Sikhism";
            thSource.textContent = "English Title";
            thTarget.textContent = "Punjabi Link";
        } else {
            inputLabel.textContent = "Input (Punjabi Titles):";
            outputLabel.textContent = "Found on English Wiki (Copy List):";
            textarea.placeholder = "Example:\n‡®ó‡©Å‡®∞‡©Ç ‡®ó‡©ã‡®¨‡®ø‡©∞‡®¶ ‡®∏‡®ø‡©∞‡®ò\n‡®∏‡®º‡©ç‡®∞‡©á‡®£‡©Ä:‡®∏‡®ø‡©±‡®ñ ‡®ß‡®∞‡®Æ";
            thSource.textContent = "Punjabi Title";
            thTarget.textContent = "English Link";
        }
    }

    // --- Theme Logic ---
    function toggleTheme() {
        const body = document.body;
        const btn = document.querySelector('.theme-toggle');
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            btn.textContent = "‚òÄ Light Mode"; localStorage.setItem('theme', 'dark');
        } else {
            btn.textContent = "üåô Dark Mode"; localStorage.setItem('theme', 'light');
        }
    }
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme === 'dark') { document.body.classList.add('dark-mode'); document.querySelector('.theme-toggle').textContent = "‚òÄ Light Mode"; }
    else if (savedTheme === 'light') { document.body.classList.remove('dark-mode'); document.querySelector('.theme-toggle').textContent = "üåô Dark Mode"; }
    else if (systemPrefersDark) { document.body.classList.add('dark-mode'); document.querySelector('.theme-toggle').textContent = "‚òÄ Light Mode"; }

    // --- Processing Logic ---
    async function processList() {
        const input = document.getElementById('inputList').value;
        const statusDiv = document.getElementById('status');
        const tbody = document.getElementById('resultsBody');
        const table = document.getElementById('resultsTable');
        const outputBox = document.getElementById('outputRaw');
        const btn = document.getElementById('btnCheck');
        
        const direction = document.querySelector('input[name="langDirection"]:checked').value;
        const sourceLang = direction === 'en2pa' ? 'en' : 'pa';
        const targetLang = direction === 'en2pa' ? 'pa' : 'en';

        tbody.innerHTML = '';
        outputBox.value = '';
        table.style.display = 'none';
        
        if (!input.trim()) { alert("Please enter at least one item."); return; }

        btn.disabled = true;
        btn.textContent = "Checking...";
        statusDiv.textContent = "";
        
        let rawLines = input.split('\n');
        
        let items = rawLines.map(line => {
            // 1. Remove [[ and ]]
            let clean = line.replace(/\[\[|\]\]/g, '');
            
            // 2. PIPE FIX: Remove anything after the pipe |
            // Example: [[Category:Name|*]] becomes Category:Name
            if (clean.includes('|')) {
                clean = clean.split('|')[0];
            }
            
            clean = clean.trim();
            if (!clean) return null;
            return prepareTitle(clean, direction);
        }).filter(c => c && c !== ':'); 

        // Batch size 5 for high reliability
        const batchSize = 5;
        
        try {
            for (let i = 0; i < items.length; i += batchSize) {
                const batch = items.slice(i, i + batchSize);
                await fetchBatch(batch, sourceLang, targetLang);
                
                if (i + batchSize < items.length) {
                    await new Promise(r => setTimeout(r, 300)); 
                }
            }
            statusDiv.textContent = `Done! Processed ${items.length} items.`;
        } catch (e) {
            console.error(e);
            statusDiv.textContent = "An error occurred. Check input format.";
        }
        
        table.style.display = 'table';
        btn.disabled = false;
        btn.textContent = "Check Availability";
    }

    async function fetchBatch(batch, sourceLang, targetLang) {
        const outputBox = document.getElementById('outputRaw');
        
        const titlesParam = batch.map(t => encodeURIComponent(t)).join('|');
        const url = `https://${sourceLang}.wikipedia.org/w/api.php?action=query&format=json&origin=*&redirects=1&converts=1&prop=langlinks&lllang=${targetLang}&llprop=url&titles=${titlesParam}`;

        try {
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }

            const data = await response.json();
            const pages = data.query?.pages || {};

            Object.values(pages).forEach(page => {
                const row = document.createElement('tr');
                const sourceCell = document.createElement('td');
                const targetCell = document.createElement('td');

                sourceCell.textContent = page.title;

                if (typeof page.pageid === 'undefined' && page.missing !== undefined) {
                    targetCell.textContent = "Page doesn't exist on Source Wiki";
                    targetCell.className = "not-exist";
                } 
                else if (page.langlinks && page.langlinks.length > 0) {
                    const targetLink = page.langlinks[0];
                    const targetTitle = targetLink['*'];
                    
                    const link = document.createElement('a');
                    link.href = targetLink.url;
                    link.target = "_blank";
                    link.textContent = targetTitle;
                    targetCell.appendChild(link);

                    outputBox.value += `[[${targetTitle}]]\n`;
                } 
                else {
                    targetCell.textContent = "Not found / No link";
                    targetCell.className = "missing";
                }

                row.appendChild(sourceCell);
                row.appendChild(targetCell);
                document.getElementById('resultsBody').appendChild(row);
            });

        } catch (error) {
            console.error("Error fetching data:", error);
            outputBox.value += `Error: ${error.message} (Batch skipped)\n`;
        }
    }

    function copyOutput() {
        const copyText = document.getElementById("outputRaw");
        const btn = document.querySelector(".copy-btn-overlay");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            const originalText = btn.textContent;
            btn.textContent = "Copied!";
            btn.style.backgroundColor = "#2563eb"; btn.style.color = "white"; btn.style.borderColor = "#2563eb";
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = ""; btn.style.color = ""; btn.style.borderColor = "";
            }, 2000);
        });
    }

    updateUI();
</script>

</body>
</html>
